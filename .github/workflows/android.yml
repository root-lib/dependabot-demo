name: Android CI

on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev ]

jobs:
  static-query:
    runs-on: ubuntu-16.04
    steps:
    - uses: actions/checkout@v2
    - uses: helaili/github-graphql-action@2.0.1
      env:
        GITHUB_TOKEN: ${{ secrets.PAT }}
      with:
        query: samples/oss-vuln.yaml
        outputFile: vulnResult.json
    - name: Upload vuln-results
      uses: actions/upload-artifact@v2
      with:
        name: vulnResult
        path: vulnResult.json
    - name: Analyse results
      id: analyse_vuln
      uses: root-lib/dependabot-action@main
      with:
        path: 'vulnResult.json'
        jira_url: ${{secrets.JIRAURL}}
        token: ${{ secrets.JIRA_SECRET}}
        github_token: ${{ secrets.PAT }}
        github_url: ${{secrets.GITURL}}
    - name: Print results json
      run: |
        echo "${{steps.analyse_vuln.outputs.ticketLists}}"
  printresults:
    name: download results
    needs: static-query
    runs-on: windows-latest
    steps:
      - name: Download vulnresults
        uses: actions/download-artifact@v2
        with:
          name: vulnResult
      - shell: bash
        run: |
          value=`cat vulnResult.json`
          echo $value
